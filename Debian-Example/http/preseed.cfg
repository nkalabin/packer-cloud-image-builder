# Preconfiguration file for Debian 12 (bookworm)
# Reference: https://www.debian.org/releases/bookworm/example-preseed.txt
d-i debian-installer/locale string en_US
d-i keyboard-configuration/xkb-keymap select us

# Choose an network interface that has link if possible.
d-i netcfg/choose_interface select auto

# Disable that annoying WEP key dialog.
d-i netcfg/wireless_wep string

# Mirror settings.
d-i mirror/country string manual
d-i mirror/http/hostname string deb.debian.org
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string

# Enable additional sections (recommended for Debian 12 with firmware)
d-i apt-setup/cdrom/set-first boolean false
#d-i apt-setup/contrib boolean true
#d-i apt-setup/non-free boolean true
#d-i apt-setup/non-free-firmware boolean true

# Accounts
#
# Default: create a regular sudo-capable user, disable direct root login.
# To use a ROOT account instead and skip user creation, see CHOICES at the end.
d-i passwd/root-login boolean false
d-i passwd/user-fullname string debian
d-i passwd/username string debian
d-i passwd/user-password password debian
d-i passwd/user-password-again password debian

# Controls whether or not the hardware clock is set to UTC.
d-i clock-setup/utc boolean true
# See the contents of /usr/share/zoneinfo/ for valid values.
d-i time/zone string Europe/Moscow
# Controls whether to use NTP to set the clock during the install.
d-i clock-setup/ntp boolean true

d-i partman-basicfilesystems/choose_label string gpt
d-i partman-basicfilesystems/default_label string gpt
d-i partman-partitioning/choose_label string gpt
d-i partman-partitioning/default_label string gpt
d-i partman/choose_label string gpt
d-i partman/default_label string gpt
partman-partitioning partman-partitioning/choose_label select gpt
d-i partman-auto/disk string /dev/vda
d-i partman-auto/method string regular
d-i partman-auto/expert_recipe string         \
   root-swap ::                               \
     1000 1000 0 linux-swap                   \
         $primary{ }                          \
         method{ swap } format{ } .           \
     1000 20000 -1 ext4                       \
         $primary{ }                          \
         method{ format } format{ }           \
         use_filesystem{ } filesystem{ ext4 } \
         mountpoint{ / } .                    \
d-i partman-partitioning/confirm_write_new_label boolean true
d-i partman/choose_partition select finish
d-i partman/confirm boolean true
d-i partman/confirm_nooverwrite boolean true

# Package selection and tasks
#
# CHOICES:
# 1) Minimal server (default):
#    - Keeps recommendations off, installs standard + ssh-server
# 2) Desktop (uncomment ONE of the desktop tasks, and flip recommends to true):
#    - gnome-desktop | xfce-desktop | kde-desktop | lxde-desktop | lxqt-desktop | cinnamon-desktop | mate-desktop

### Base system installation
# Configure APT to not install recommended packages by default. Use of this
# option can result in an incomplete system and should only be used by very
# experienced users.
#d-i base-installer/install-recommends boolean false
tasksel tasksel/first multiselect standard

# To install a desktop environment instead, uncomment the next two lines and pick one desktop task:
# d-i base-installer/install-recommends boolean true
# tasksel tasksel/first multiselect standard, gnome-desktop

# Individual additional packages to install.
# ACPI packages are needed for `virsh shutdown <domain>` to work.
# Include cloud-init and grow tools for auto-resize on first boot (growpart/initramfs)
d-i pkgsel/include string sudo, unattended-upgrades, dpkg, cloud-init, cloud-guest-utils, cloud-initramfs-growroot, cloud-image-utils, cloud-utils, openssh-server
popularity-contest popularity-contest/participate boolean false

# Bootloader installation.
# NOTE: /dev/vda is typical for Virtio (KVM/QEMU). On SATA/VMware it may be /dev/sda
d-i grub-installer/bootdev string /dev/vda

# Avoid that last message about the install being complete.
# NOTE: With root disabled, the installer installs sudo and grants the first user admin rights.
# The following line is redundant in that case; keep commented unless you enable root or skip sudo.
# d-i preseed/late_command string in-target adduser debian sudo
d-i finish-install/reboot_in_progress note

# ---
# CHOICES (alternative account model):
#
# Use a ROOT account and do not create a regular user:
# d-i passwd/root-login boolean true
# d-i passwd/root-password password <root_password>
# d-i passwd/root-password-again password <root_password>
# d-i passwd/make-user boolean false

# Desktop choices (examples):
#   - GNOME:    tasksel tasksel/first multiselect standard, gnome-desktop
#   - XFCE:     tasksel tasksel/first multiselect standard, xfce-desktop
#   - KDE:      tasksel tasksel/first multiselect standard, kde-desktop
#   - LXQt:     tasksel tasksel/first multiselect standard, lxqt-desktop
#   - Cinnamon: tasksel tasksel/first multiselect standard, cinnamon-desktop
#   - MATE:     tasksel tasksel/first multiselect standard, mate-desktop
